# Тестовое задание Backend/Django от команды HardQode

## Установка и запуск
Приложение запускается, имеет простейший интерфейс. Выводит список доступных продуктов. Есть возможность
зарегистрироваться и купить продукт. 
<details>
  <summary>Подробности</summary>

1. Клонировать репозиторий: 
```commandline 
git clone https://github.com/amoglock/HQ_test_task.git <br>
  ```
2. Перейти в папку с проектом.<br>
2. Создать виртуальное окружение: `python -m venv venv`<br>
3. Активировать виртуальное окружение:<br>
   - На Windows: `venv\Scripts\activate`<br>
   - На macOS/Linux: `source venv/bin/activate`<br>
4. Установить зависимости: `pip install -r requirements.txt`<br>

## Использование

1. Создать и запустить миграции:<br> 
   - `python manage.py makemigrations` <br>
   - `python manage.py migrate`<>br
2. Запустить сервер разработки: `python manage.py runserver`
4. Для заполнения базы данных:<br>
   - `python manage.py loaddata products/fixtures/courses.json` 
   - `python manage.py loaddata products/fixtures/lessons.json`
 
5. Перейти к приложению по адресу http://127.0.0.1:8000/
</details>

## Задание

### Построение архитектуры(6 баллов)
В этом задании у нас есть три бизнес-задачи на хранение:

1. Создать сущность продукта. У продукта должен быть создатель этого продукта(автор/преподаватель). Название продукта, 
   дата и время старта, стоимость (1 балл)
> Сущность продукта реализована в виде модели Product в файле [products/models.py](https://github.com/amoglock/HQ_test_task/blob/master/products/models.py).

2. Определить, каким образом мы будем понимать, что у пользователя(клиент/студент) есть доступ к продукту. (2 балл)
> Доступ к продукту определяется моделью Purchase в файле [products/models.py](https://github.com/amoglock/HQ_test_task/blob/master/products/models.py).
> Где после покупки продукт связывается с пользователем. Для получения доступа к продукту необходимо проверить,
> что в модели есть связь пользователь + продукт.

3. Создать сущность урока. Урок может принадлежать только одному продукту.. В уроке должна быть базовая информация: 
   название, ссылка на видео. (1 балл)
> Сущность продукта реализована в виде модели Lesson в файле [products/models.py](https://github.com/amoglock/HQ_test_task/blob/master/products/models.py).

4. Создать сущность группы. По каждому продукту есть несколько групп пользователей, которые занимаются в этом продукте. 
   Минимальное и максимальное количество юзеров в группе задается внутри продукта. Группа содержит следующую информацию: 
   ученики, которые состоят в группе, название группы, принадлежность группы к продукту (2 балла)
> Сущность продукта реализована в виде модели Team в файле [products/models.py](https://github.com/amoglock/HQ_test_task/blob/master/products/models.py).

### Написание запросов и реализация логики распределения(11 баллов)

В этом пункте потребуется использовать выполненную вами в прошлом задании архитектуру:

1. При получении доступа к продукту, распределять пользователя в группу. Если продукт ещё не начался, то можно 
   пересобрать группы так, чтобы везде было примерно одинаковое количество участников.

   По-умолчанию алгоритм распределения должен работать заполняя до максимального значения (5 баллов).
> Алгоритм реализован в файле [utils/add_student.py](https://github.com/amoglock/HQ_test_task/blob/master/products/utils/add_student.py).
> После покупки, студент добавляется в группу, если ее не существует - она создается. Если группа заполнена максимальным
> количеством студентов, указанным в модели продукта, при следующей покупке будет создана новая группа.
   
   +3 балла дается за реализацию алгоритма распределения по группам так, чтобы в каждой группе количество участников не 
   отличалось больше, чем на 1. При этом, минимальные и максимальные значения участников в группе должны быть учтены.
> Алгоритм реализован в файле [utils/sort_student.py](https://github.com/amoglock/HQ_test_task/blob/master/products/utils/sort_student.py).
> Работа алгоритма указана в комментариях к коду. Данный функционал доступен только из панели администратора как action
> "Перераспределить участников в группах" для Products.

2. Реализовать API на список продуктов, доступных для покупки, которое бы включало в себя основную информацию о продукте 
   и количество уроков, которые принадлежат продукту. (2 балла)
> API реализовано по адресу http://127.0.0.1:8000/api/products/   

3. Реализовать API с выведением списка уроков по конкретному продукту к которому пользователь имеет доступ. (1 балл).
> API реализовано по адресу http://127.0.0.1:8000/api/products/{product_id}/lessons/{user_id} 

### Бонусные задачи

Необходимо отобразить список всех продуктов на платформе, к каждому продукту приложить информацию:
1. Количество учеников занимающихся на продукте.
2. На сколько % заполнены группы? (среднее значение по количеству участников в группах от максимального значения 
   участников в группе).
3. Процент приобретения продукта (рассчитывается исходя из количества полученных доступов к продукту деленное на общее 
   количество пользователей на платформе).

> Все задачи реализованы дополнительными полями к API списка продуктов по адресу http://127.0.0.1:8000/api/products/